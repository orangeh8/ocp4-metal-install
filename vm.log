# 启动节点时引导参数
ip=dhcp coreos.inst.install_dev=/dev/sda coreos.inst.insecure=yes coreos.inst.ignition_url=http://192.168.22.1:8080/ocp4/bootstrap.ign
ip=dhcp coreos.inst.install_dev=/dev/sda coreos.inst.insecure=yes coreos.inst.ignition_url=http://192.168.22.1:8080/ocp4/master.ign
ip=dhcp coreos.inst.install_dev=/dev/sda coreos.inst.insecure=yes coreos.inst.ignition_url=http://192.168.22.1:8080/ocp4/worker.ign


# Bootstrap Node - ocp-bootstrap
ip=dhcp coreos.inst.install_dev=/dev/sda coreos.inst.insecure=yes coreos.inst.ignition_url=http://192.168.22.1:8080/ocp4/bootstrap.ign
# Or if you waited for it boot, use the following command then just reboot after it finishes and make sure you remove the attached .iso
sudo coreos-installer install /dev/sda -I http://192.168.22.1:8080/ocp4/bootstrap.ign --insecure --insecure-ignition


# 网卡绑定到对应的firewall zone
nmcli connection modify ens224 connection.zone internal
nmcli connection modify ens192 connection.zone external

# 添加网卡网络共享
firewall-cmd --zone=external --add-masquerade --permanent
firewall-cmd --zone=internal --add-masquerade --permanent

# 删除网卡网络共享
firewall-cmd --zone=external --del-masquerade --permanent

# 查看防火墙规则
firewall-cmd --list-all --zone=internal
firewall-cmd --list-all --zone=external


# 指定网卡地址，测试网络是否通畅
curl -4 --interface ens192 -v https://quay.io 可以正常访问
curl -4 --interface ens224 -v https://quay.io 不能访问

# 查看路由表
[root@ocp-svc ~]# ip route show
default via 192.168.31.1 dev ens192 proto dhcp src 192.168.31.168 metric 100
192.168.22.0/24 dev ens224 proto kernel scope link src 192.168.22.1 metric 101
192.168.31.0/24 dev ens192 proto kernel scope link src 192.168.31.168 metric 100




# 开启网卡网络共享的步骤
# Ensure firewalld is running
sudo systemctl start firewalld
sudo systemctl enable firewalld

# Add masquerade rule to public zone
sudo firewall-cmd --zone=public --add-masquerade --permanent

# Enable IP forwarding
echo "net.ipv4.ip_forward = 1" | sudo tee -a /etc/sysctl.d/99-sysctl.conf
sudo sysctl -p

# Reload firewalld
sudo firewall-cmd --reload

# Verify masquerading is enabled
sudo firewall-cmd --zone=public --query-masquerade


# 通过assisted安装openshit时，VMWare ESXi 的虚拟机需要添加如下参数。
disk.EnableUUID TRUE




# 从openshift上删除node的步骤
1. 确认etcd实例数量是否大于3
oc get pods -n openshift-etcd
2. 标记节点不可添加新负载
oc adm cordon master0.itzocp-270007kue8-zg8956vv.cp.fyre.ibm.com
3. 驱逐节点上的pod
oc adm drain master0.itzocp-270007kue8-zg8956vv.cp.fyre.ibm.com --delete-local-data --force --ignore-daemonsets
4. 删除节点
oc delete node master-0

